<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Barcode Print Generator</title>

<!-- JsBarcode -->
<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.6/dist/JsBarcode.all.min.js"></script>

<style>
:root {
    --print-cols: 3;
}

body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    margin: 0;
    padding: 12px;
}

.controls {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 12px;
    position: sticky;
    top: 0;
    background: #fff;
    z-index: 10;
}

input, button {
    font-size: 18px;
    padding: 10px;
    width: 100%;
}

button {
    background: #000;
    color: #fff;
    border: none;
    border-radius: 6px;
}

.barcode-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    gap: 10px;
}

.barcode-item {
    border: 1px solid #000;
    padding: 6px;
    text-align: center;
    background: #fff;
}

svg {
    width: 100%;
    height: auto;
}

/* Tablet / Desktop */
@media (min-width: 768px) {
    input, button {
        width: auto;
        flex: 1;
    }
}

/* PRINT MODE */
@media print {
    .controls {
        display: none;
    }

    body {
        padding: 0;
    }

    .barcode-container {
        grid-template-columns: repeat(var(--print-cols), 1fr);
        gap: 12px;
    }

    .barcode-item {
        page-break-inside: avoid;
    }
}
</style>
</head>

<body>

<div class="controls">
    <input
        type="text"
        id="barcodeInput"
        placeholder="Scan or type barcode"
        inputmode="numeric"
        autofocus
        oninput="autoGenerate()"
    >

    <input
        type="number"
        id="countInput"
        value="100"
        min="1"
        oninput="autoGenerate()"
        title="Total barcodes"
    >

    <input
        type="number"
        id="colsInput"
        value="3"
        min="1"
        max="10"
        oninput="updateCols(); autoGenerate();"
        title="Barcodes per row (print)"
    >

    <button onclick="window.print()">Print</button>
</div>

<div class="barcode-container" id="barcodeContainer"></div>

<script>
let debounceTimer = null;

function updateCols() {
    const cols = parseInt(document.getElementById('colsInput').value) || 3;
    document.documentElement.style.setProperty('--print-cols', cols);
}

function autoGenerate() {
    clearTimeout(debounceTimer);

    debounceTimer = setTimeout(() => {
        const value = document.getElementById('barcodeInput').value.trim();
        const count = parseInt(document.getElementById('countInput').value);
        const cols = parseInt(document.getElementById('colsInput').value) || 3;
        const container = document.getElementById('barcodeContainer');

        container.innerHTML = '';
        if (!value || count <= 0) return;

        // Auto-adjust barcode size based on columns
        let barWidth = 2;
        let barHeight = 60;
        let fontSize = 14;

        if (cols >= 5) {
            barWidth = 1.5;
            barHeight = 45;
            fontSize = 12;
        }
        if (cols >= 8) {
            barWidth = 1;
            barHeight = 35;
            fontSize = 10;
        }

        for (let i = 0; i < count; i++) {
            const item = document.createElement('div');
            item.className = 'barcode-item';

            const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            item.appendChild(svg);
            container.appendChild(item);

            JsBarcode(svg, value, {
                format: "CODE128",
                width: barWidth,
                height: barHeight,
                displayValue: true,
                fontSize: fontSize,
                margin: 4
            });
        }
    }, 120);
}

// Init defaults
updateCols();
</script>

</body>
</html>
